<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Support Live Board</title>
    
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --bg: #f4f7f6;
        }

        body { background: var(--bg); margin: 0; font-family: 'Inter', 'Kanit', sans-serif; color: #333; }
        
        .navbar { 
            background: white; padding: 1rem 2rem; 
            display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; z-index: 100; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
        }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 10px; }

        #board { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 20px; padding: 30px; 
        }
        
        .post-it {
            background: white; min-height: 180px; padding: 20px; 
            border-radius: 16px; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor: pointer; border: 1px solid #eee;
        }
        .post-it:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .post-it.working { border: 2px solid var(--success); background: #f0fff4; }
        
        .post-it h3 { margin: 0 0 10px 0; font-size: 1.2rem; color: var(--primary); }
        .post-it p { margin: 0; font-size: 0.95rem; color: #666; line-height: 1.5; word-wrap: break-word; }
        .status-tag { 
            margin-top: 15px; font-size: 0.8rem; font-weight: 600;
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            background: #eee; color: #777;
        }
        .working .status-tag { background: var(--success); color: white; }

        .add-btn { 
            background: var(--primary); color: white; border: none; 
            padding: 12px 24px; border-radius: 12px; font-size: 1rem; 
            font-weight: 600; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .add-btn:hover { background: #1a252f; transform: scale(1.02); }

        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px); align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 24px;
            width: 90%; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-content h2 { margin-top: 0; font-size: 1.5rem; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600; color: #555; }
        .input-group input, .input-group textarea {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;
            box-sizing: border-box; font-family: inherit; font-size: 1rem; outline: none;
        }
        .input-group input:focus, .input-group textarea:focus { border-color: var(--accent); }
        
        .modal-footer { display: flex; gap: 10px; margin-top: 25px; }
        .btn { flex: 1; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .btn-cancel { background: #eee; color: #555; }
        .btn-save { background: var(--accent); color: white; }
    </style>
</head>
<body>

<div class="navbar">
    <div class="logo">üìå <span>IT Helpdesk</span></div>
    <button class="add-btn" id="openModalBtn"><span>+</span> ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</button>
</div>

<div id="board"></div>

<div id="todoModal" class="modal">
    <div class="modal-content">
        <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
        <div class="input-group">
            <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡πâ‡∏≠‡∏á / ‡πÅ‡∏ú‡∏ô‡∏Å</label>
            <input type="text" id="roomInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô 405 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô">
        </div>
        <div class="input-group">
            <label>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
            <textarea id="issueInput" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤..."></textarea>
        </div>
        <div class="modal-footer">
            <button class="btn btn-cancel" id="closeModalBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-save" id="saveBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBPbR14mO9NQGA0PiKzsiEdiaQjhgFcnNs",
        authDomain: "it-support-dashboard-f6c3c.firebaseapp.com",
        databaseURL: "https://it-support-dashboard-f6c3c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "it-support-dashboard-f6c3c",
        storageBucket: "it-support-dashboard-f6c3c.firebasestorage.app",
        messagingSenderId: "170069879038",
        appId: "1:170069879038:web:01a93c31a4181a08b01daf",
        measurementId: "G-TH3N07MF0H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tasksRef = ref(db, 'tasks');

    // Audio & State Logic
    const alertSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3');
    let initialLoad = true;
    let lastTaskCount = 0;

    // UI Elements
    const modal = document.getElementById('todoModal');
    const openBtn = document.getElementById('openModalBtn');
    const closeBtn = document.getElementById('closeModalBtn');
    const saveBtn = document.getElementById('saveBtn');

    openBtn.onclick = () => modal.style.display = 'flex';
    closeBtn.onclick = () => { modal.style.display = 'none'; clearInput(); }
    
    function clearInput() {
        document.getElementById('roomInput').value = '';
        document.getElementById('issueInput').value = '';
    }

    saveBtn.onclick = () => {
        const room = document.getElementById('roomInput').value;
        const issue = document.getElementById('issueInput').value;
        if (room && issue) {
            push(tasksRef, { room, issue, status: 'pending' });
            modal.style.display = 'none';
            clearInput();
        } else {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
        }
    };

    // Main Listen & Render Function
    onValue(tasksRef, (snapshot) => {
        const data = snapshot.val();
        const board = document.getElementById('board');
        board.innerHTML = '';
        
        if (data) {
            const currentTaskCount = Object.keys(data).length;

            // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏î‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
            if (!initialLoad && currentTaskCount > lastTaskCount) {
                alertSound.play().catch(e => console.log("‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á"));
            }

            lastTaskCount = currentTaskCount;
            initialLoad = false;

            // ‡∏ß‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î
            Object.keys(data).forEach(id => {
                const task = data[id];
                const card = document.createElement('div');
                card.className = `post-it ${task.status === 'working' ? 'working' : ''}`;
                card.innerHTML = `
                    <h3>üìç ‡∏´‡πâ‡∏≠‡∏á ${task.room}</h3>
                    <p>${task.issue}</p>
                    <div class="status-tag">${task.status === 'working' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...' : '‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß'}</div>
                `;

                // Double Click: ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
                card.ondblclick = () => {
                    if (task.status === 'pending') update(ref(db, `tasks/${id}`), { status: 'working' });
                };

                // Triple Click: ‡∏•‡∏ö‡∏á‡∏≤‡∏ô
                let clicks = 0;
                card.onclick = () => {
                    clicks++;
                    if (clicks === 3) {
                        if (confirm(`‡πÄ‡∏™‡∏£‡πá‡∏à‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á ${task.room} ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`)) remove(ref(db, `tasks/${id}`));
                        clicks = 0;
                    }
                    setTimeout(() => clicks = 0, 400);
                };
                board.appendChild(card);
            });
        } else {
            lastTaskCount = 0;
            initialLoad = false;
        }
    });
</script>

</body>
</html>